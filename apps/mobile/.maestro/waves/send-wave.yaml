appId: com.blisko.app
---
# Send Wave E2E Test
# Tests that user can send a wave and see it in sent waves list

- launchApp:
    clearState: true
    permissions:
      location: always

# Dev build shows launcher - tap on localhost to connect
- extendedWaitUntil:
    visible: "http://localhost:8081"
    timeout: 15000
- tapOn: "http://localhost:8081"

# Wait for app to load and developer menu to appear
- extendedWaitUntil:
    visible: "Continue"
    timeout: 30000

# Dismiss first developer menu
- tapOn: "Continue"

# Wait for second developer menu (with Go home)
- extendedWaitUntil:
    visible: "Go home"
    timeout: 10000

# Tap outside modal to dismiss it
- tapOn:
    point: "50%,10%"
- waitForAnimationToEnd

# Wait for login screen
- extendedWaitUntil:
    visible:
      id: "email-input"
    timeout: 30000

# Enter unique email - use inputRandomNumber for unique ID
- tapOn:
    id: "email-input"
- inputRandomNumber
- inputText: "@example.com"
# Tap outside to dismiss keyboard
- tapOn:
    point: "50%,30%"

# Submit login
- tapOn: "Wyślij link"

# Wait for onboarding step 1 (1/3)
- extendedWaitUntil:
    visible: "1 / 3"
    timeout: 30000

# Step 1: Name
- tapOn:
    id: "name-input"
- inputText: "Wave Sender User"
- tapOn:
    point: "50%,30%"
- waitForAnimationToEnd
- tapOn: "Dalej"

# Wait for step 2 (2/3)
- extendedWaitUntil:
    visible: "2 / 3"
    timeout: 10000

# Step 2: Bio
- tapOn:
    id: "bio-input"
- inputText: "Testowy user wysylajacy zaczepienia w aplikacji Blisko"
- tapOn:
    point: "50%,20%"
- waitForAnimationToEnd
- extendedWaitUntil:
    visible: "Dalej"
    timeout: 5000
- tapOn: "Dalej"

# Wait for step 3 (3/3)
- extendedWaitUntil:
    visible: "3 / 3"
    timeout: 10000

# Step 3: Looking for
- tapOn:
    id: "looking-for-input"
- inputText: "Szukam ludzi zeby ich zaczepiać w testach"
- tapOn:
    point: "50%,20%"
- waitForAnimationToEnd

# Set simulated location (Warsaw)
- setLocation:
    latitude: 52.2297
    longitude: 21.0122

# Submit onboarding
- extendedWaitUntil:
    visible: "Rozpocznij"
    timeout: 5000
- tapOn: "Rozpocznij"

# Verify we landed on W okolicy tab (header is visible)
- extendedWaitUntil:
    visible: "W okolicy"
    timeout: 30000

# Small delay for screen to fully render
- swipe:
    start: "50%,50%"
    end: "50%,52%"
    duration: 100
- waitForAnimationToEnd

# Tap on first "Zaczep" button to send a wave
- tapOn:
    id: "wave-button"

# Wait for success alert (looking for "OK" button which is part of the alert)
- extendedWaitUntil:
    visible: "OK"
    timeout: 10000

# Dismiss the alert
- tapOn: "OK"

# Navigate to Waves tab
- tapOn:
    point: "37%,96%"

# Wait for waves screen to load
- extendedWaitUntil:
    visible:
      id: "waves-screen"
    timeout: 10000

# Switch to sent tab to see the wave we just sent
- tapOn:
    id: "waves-tab-sent"

# Wait for sent waves list to load
- extendedWaitUntil:
    visible: "Oczekuje"
    timeout: 10000

# Verify we see a wave card with pending status
- assertVisible: "Oczekuje"
